<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ëª¨ë¦¬ ê²Œì„ ë©”ì´ì»¤</title>
    <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #FFFBEB; margin: 0; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .perspective { perspective: 1200px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoom-in { from { transform: scale(0.95); } to { transform: scale(1); } }
        .animate-in { animation: fade-in 0.3s ease-out, zoom-in 0.3s ease-out; }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #F97316;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 4px solid white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ì•„ì´ì½˜ ë Œë”ë§ì„ ìœ„í•œ ê°€ì¥ ì•ˆì •ì ì¸ í—¬í¼ ì»´í¬ë„ŒíŠ¸
        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current && window.lucide) {
                    iconRef.current.innerHTML = '';
                    const i = document.createElement('i');
                    const kebabName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
                    i.setAttribute('data-lucide', kebabName);
                    i.style.width = `${size}px`;
                    i.style.height = `${size}px`;
                    i.style.display = 'inline-block';
                    i.className = className;
                    iconRef.current.appendChild(i);
                    window.lucide.createIcons();
                }
            }, [name, size, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center leading-none" />;
        };

        const App = () => {
            // ğŸ’¡ ì¤‘ìš”: ì•„ë˜ í°ë”°ì˜´í‘œ("") ì‚¬ì´ì— Google AI Studioì—ì„œ ë°œê¸‰ë°›ì€ API í‚¤ë¥¼ ë„£ì–´ì£¼ì„¸ìš”!
            // í‚¤ê°€ ì—†ìœ¼ë©´ AI ê·¸ë¦¼ ìƒì„± ê¸°ëŠ¥ì´ ì‘ë™í•˜ì§€ ì•Šê³  íšŒìƒ‰ ìƒìë¡œ í‘œì‹œë©ë‹ˆë‹¤.
            const apiKey = "AIzaSyCMRCqDmox58s_QxApOIMC9UCsRPjIHe5o"; 

            const [view, setView] = useState('settings'); 
            const [activeStep, setActiveStep] = useState(1); 
            const [toast, setToast] = useState({ show: false, message: "" });
            
            const [config, setConfig] = useState({
                cardCount: 12,
                contentType: null, 
                pictureMode: null,   
                gameType: null, 
                playerCount: null,
            });

            // ì…ë ¥ ë°ì´í„° ìƒíƒœ
            const [wordInputs, setWordInputs] = useState(Array.from({ length: 12 }, () => ({ a: '', b: '' })));
            const [fractionInputs, setFractionInputs] = useState(Array.from({ length: 12 }, () => ({ a: { whole: '', num: '', den: '' }, b: { whole: '', num: '', den: '' } })));
            const [pictureInputs, setPictureInputs] = useState(Array.from({ length: 12 }, () => ({ a: '', b: '' })));

            const [cards, setCards] = useState([]);
            const [flippedIndices, setFlippedIndices] = useState([]);
            const [matchedIds, setMatchedIds] = useState([]);
            const [scores, setScores] = useState([]); 
            const [attempts, setAttempts] = useState([]); 
            const [currentPlayer, setCurrentPlayer] = useState(0);
            const [isProcessing, setIsProcessing] = useState(false);
            const [loadingProgress, setLoadingProgress] = useState(0);
            const [loadingStatus, setLoadingStatus] = useState("");
            const [elapsedTime, setElapsedTime] = useState(0);
            const [gameStarted, setGameStarted] = useState(false); 
            const [errorMessage, setErrorMessage] = useState(null);
            const [capturedImage, setCapturedImage] = useState(null);
            const [isCapturing, setIsCapturing] = useState(false);
            const [userName, setUserName] = useState("");

            const timerRef = useRef(null);
            const resultRef = useRef(null);

            const isStepLocked = (step) => activeStep < step;
            const showToast = (message) => setToast({ show: true, message });

            useEffect(() => {
                if (toast.show) {
                    const t = setTimeout(() => setToast({ show: false, message: "" }), 3000);
                    return () => clearTimeout(t);
                }
            }, [toast.show]);

            // ì¹´ë“œ ìˆ˜ëŸ‰ ë³€ê²½ ì‹œ ë°°ì—´ í¬ê¸° ë™ê¸°í™”
            useEffect(() => {
                const pairCount = Math.floor(config.cardCount / 2);
                const syncArray = (prev, type) => {
                    const newArr = [...prev];
                    if (newArr.length < pairCount) {
                        const diff = pairCount - newArr.length;
                        const add = Array.from({ length: diff }, () => {
                            if (type === 'fraction') return { a: { whole: '', num: '', den: '' }, b: { whole: '', num: '', den: '' } };
                            return { a: '', b: '' };
                        });
                        return [...newArr, ...add];
                    }
                    return newArr.slice(0, pairCount);
                };
                setWordInputs(p => syncArray(p, 'word'));
                setPictureInputs(p => syncArray(p, 'picture'));
                setFractionInputs(p => syncArray(p, 'fraction'));
            }, [config.cardCount]);

            // íƒ€ì´ë¨¸ ë¡œì§
            useEffect(() => {
                if (view === 'playing' && config.playerCount === 1 && gameStarted) {
                    timerRef.current = setInterval(() => setElapsedTime(prev => prev + 1), 1000);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [view, config.playerCount, gameStarted]);

            const handleFileUpload = (index, file) => {
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const n = [...pictureInputs];
                    n[index] = { ...n[index], b: e.target.result };
                    setPictureInputs(n);
                };
                reader.readAsDataURL(file);
            };

            const fetchAiImage = async (prompt) => {
                if (!apiKey) return null;
                const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            instances: [{ prompt: `${prompt}, cute simple educational game illustration, pastel colors, white background` }],
                            parameters: { sampleCount: 1 }
                        })
                    });
                    const result = await response.json();
                    if (result.predictions && result.predictions[0]) {
                        return `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                    }
                    return null;
                } catch (e) { return null; }
            };

            const handleStartRequest = async () => {
                setLoadingStatus("ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³  ìˆì–´ìš”...");
                setView('loading');
                setLoadingProgress(10);
                
                const pairCount = config.cardCount / 2;
                let deck = [];

                if (config.contentType === 'picture' && config.pictureMode === 'ai') {
                    for (let i = 0; i < pairCount; i++) {
                        setLoadingStatus(`AIê°€ ${i+1}ë²ˆì§¸ ê·¸ë¦¼ì„ ê·¸ë ¤ìš”! ğŸ¨`);
                        const img = await fetchAiImage(pictureInputs[i].a);
                        const content = img || `https://via.placeholder.com/300/fef3c7/f97316?text=${pictureInputs[i].a || 'Error'}`;
                        
                        if (config.gameType === 'associative') {
                            deck.push({ id: i, content: pictureInputs[i].a, type: 'text', instanceId: Math.random() });
                            deck.push({ id: i, content: content, type: 'image', instanceId: Math.random() });
                        } else {
                            deck.push({ id: i, content: content, type: 'image', instanceId: Math.random() });
                            deck.push({ id: i, content: content, type: 'image', instanceId: Math.random() });
                        }
                        setLoadingProgress(10 + Math.floor(((i+1)/pairCount) * 85));
                    }
                    setCards(deck.sort(() => Math.random() - 0.5));
                    setLoadingProgress(100);
                    setView('preview');
                } else {
                    if (config.contentType === 'picture') {
                        for (let i = 0; i < pairCount; i++) {
                            if (config.gameType === 'associative') {
                                deck.push({ id: i, content: pictureInputs[i].a, type: 'text', instanceId: Math.random() });
                                deck.push({ id: i, content: pictureInputs[i].b, type: 'image', instanceId: Math.random() });
                            } else {
                                deck.push({ id: i, content: pictureInputs[i].b, type: 'image', instanceId: Math.random() });
                                deck.push({ id: i, content: pictureInputs[i].b, type: 'image', instanceId: Math.random() });
                            }
                        }
                    } else if (config.contentType === 'word') {
                        wordInputs.slice(0, pairCount).forEach((v, i) => {
                            deck.push({ id: i, content: v.a, type: 'text', instanceId: Math.random() });
                            deck.push({ id: i, content: config.gameType === 'identical' ? v.a : v.b, type: 'text', instanceId: Math.random() });
                        });
                    } else if (config.contentType === 'fraction') {
                        fractionInputs.slice(0, pairCount).forEach((v, i) => {
                            deck.push({ id: i, content: v.a, type: 'fraction', instanceId: Math.random() });
                            deck.push({ id: i, content: config.gameType === 'identical' ? v.a : v.b, type: 'fraction', instanceId: Math.random() });
                        });
                    }
                    setCards(deck.sort(() => Math.random() - 0.5));
                    setLoadingProgress(100);
                    setTimeout(() => startMainGame(), 800);
                }
            };

            const startMainGame = () => {
                setScores(Array(config.playerCount || 1).fill(0));
                setAttempts(Array(config.playerCount || 1).fill(0));
                setCurrentPlayer(0);
                setMatchedIds([]);
                setFlippedIndices([]);
                setElapsedTime(0);
                setGameStarted(false);
                setView('playing');
            };

            const handleCardClick = (idx) => {
                if (isProcessing || flippedIndices.includes(idx) || matchedIds.includes(cards[idx].id)) return;
                if (!gameStarted && config.playerCount === 1) setGameStarted(true);

                const newFlipped = [...flippedIndices, idx];
                setFlippedIndices(newFlipped);
                if (newFlipped.length === 2) {
                    setIsProcessing(true);
                    setAttempts(prev => { const n = [...prev]; n[currentPlayer]++; return n; });
                    const [i1, i2] = newFlipped;
                    if (cards[i1].id === cards[i2].id) {
                        setTimeout(() => {
                            const newMatched = [...matchedIds, cards[i1].id];
                            setMatchedIds(newMatched);
                            setScores(prev => { const n = [...prev]; n[currentPlayer]++; return n; });
                            setFlippedIndices([]);
                            setIsProcessing(false);
                            if (newMatched.length === cards.length / 2) { setGameStarted(false); setTimeout(() => setView('result'), 600); }
                        }, 600);
                    } else {
                        setTimeout(() => {
                            setFlippedIndices([]);
                            if (config.playerCount > 1) setCurrentPlayer(p => (p + 1) % config.playerCount);
                            setIsProcessing(false);
                        }, 1000);
                    }
                }
            };

            const handleCapture = async () => {
                setIsCapturing(true);
                setTimeout(async () => {
                    const canvas = await html2canvas(resultRef.current, { backgroundColor: '#ffffff', scale: 2, useCORS: true });
                    setCapturedImage(canvas.toDataURL('image/png'));
                    setIsCapturing(false);
                }, 100);
            };

            return (
                <div className="min-h-screen selection:bg-orange-200 antialiased overflow-x-hidden font-sans">
                    {view === 'settings' && (
                        <div className="flex flex-col items-center py-6 md:py-10 px-4 animate-in">
                            {toast.show && (
                                <div className="fixed top-6 left-1/2 -translate-x-1/2 z-[100] bg-orange-600 text-white px-8 py-4 rounded-full shadow-xl flex items-center gap-3 animate-bounce max-w-[90vw]">
                                    <Icon name="Star" size={20} className="fill-white" />
                                    <span className="font-black text-sm md:text-lg">{toast.message}</span>
                                </div>
                            )}
                            <div className="w-full max-w-4xl bg-white rounded-[45px] md:rounded-[60px] shadow-[0_15px_0_0_#FEF3C7] border-[6px] md:border-[10px] border-white overflow-hidden relative">
                                <div className="bg-gradient-to-br from-orange-400 to-rose-400 p-8 md:p-14 text-center text-white">
                                    <h1 className="text-2xl md:text-5xl font-black mb-2 italic flex justify-center items-center gap-4 font-sans">
                                        <Icon name="Rocket" size={36} className="text-white" /> ë©”ëª¨ë¦¬ ê²Œì„ ë©”ì´ì»¤
                                    </h1>
                                    <p className="bg-white/20 px-6 py-2 rounded-full inline-block text-[10px] md:text-sm font-black italic">ë‚˜ë§Œì˜ ì¹´ë“œë¡œ ì¦ê¸°ëŠ” í•™ìŠµ ë†€ì´!</p>
                                </div>

                                <div className="p-6 md:p-14 space-y-12 md:space-y-16">
                                    <section className={`transition-all duration-500 ${activeStep === 1 ? 'scale-[1.02]' : ''}`}>
                                        <div className="flex items-center gap-3 mb-6 text-slate-800">
                                            <div className="w-10 h-10 md:w-12 md:h-12 bg-orange-500 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg transform rotate-3 font-sans">1</div>
                                            <h2 className="text-lg md:text-2xl font-black">ê²Œì„ ëª¨ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
                                            {activeStep > 1 && <Icon name="CheckCircle2" size={24} className="ml-auto text-emerald-500" />}
                                        </div>
                                        <div className="grid grid-cols-2 gap-4 md:gap-8 text-slate-900 font-sans">
                                            <div className="flex flex-col gap-2">
                                                <button onClick={() => { setConfig({...config, gameType: 'identical'}); setActiveStep(2); showToast("ë˜‘ê°™ì€ ëª¨ì–‘ ì°¾ê¸° ëª¨ë“œ ì„ íƒ! ğŸ¨"); }} className={`p-4 md:p-8 rounded-[30px] border-4 transition-all flex flex-col items-center gap-3 ${config.gameType === 'identical' ? 'border-orange-500 bg-orange-50 text-orange-700 shadow-md' : 'border-slate-50 bg-slate-50 text-slate-300'}`}><Icon name="Copy" size={40} className={config.gameType === 'identical' ? 'text-orange-500' : 'text-slate-300'} /><span className="text-sm md:text-xl font-black font-sans">ë˜‘ê°™ì€ ì¹´ë“œ</span></button>
                                                <p className="text-[10px] text-slate-400 text-center font-bold font-sans">ëª¨ì–‘ 2ì¥ì„ ì°¾ëŠ” ì‰¬ìš´ ëª¨ë“œ!</p>
                                            </div>
                                            <div className="flex flex-col gap-2">
                                                <button onClick={() => { setConfig({...config, gameType: 'associative'}); setActiveStep(2); showToast("ì˜ë¯¸ê°€ ê°™ì€ ì§ ì°¾ê¸° ì„ íƒ! ğŸ¨"); }} className={`p-4 md:p-8 rounded-[30px] border-4 transition-all flex flex-col items-center gap-3 ${config.gameType === 'associative' ? 'border-rose-500 bg-rose-50 text-rose-700 shadow-md' : 'border-slate-50 bg-slate-50 text-slate-300'}`}><Icon name="ArrowRightLeft" size={40} className={config.gameType === 'associative' ? 'text-rose-500' : 'text-slate-300'} /><span className="text-sm md:text-xl font-black font-sans">ì˜ë¯¸ê°€ ê°™ì€ ì¹´ë“œ</span></button>
                                                <p className="text-[10px] text-slate-400 text-center font-bold font-sans">ë‹¨ì–´ì™€ ëœ»ì²˜ëŸ¼ ì„œë¡œ ì§ì„ ì°¾ì•„ìš”!</p>
                                            </div>
                                        </div>
                                    </section>

                                    <section className={`transition-all duration-500 ${isStepLocked(2) ? 'opacity-20 pointer-events-none grayscale' : ''}`}>
                                        <div className="flex items-center gap-3 mb-6 text-slate-800 font-sans">
                                            <div className="w-10 h-10 md:w-12 md:h-12 bg-orange-500 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg transform -rotate-3 font-sans">2</div>
                                            <h2 className="text-lg md:text-2xl font-black font-sans font-black">ì¹´ë“œ ê²Œì„ ì£¼ì œ</h2>
                                        </div>
                                        <div className="grid grid-cols-3 gap-3 text-slate-900 font-sans">
                                            <button onClick={() => { setConfig({...config, contentType: 'word'}); setActiveStep(3); showToast("ë‹¨ì–´ ëª¨ë“œ ì„ íƒ! ğŸ”¢"); }} className={`p-4 rounded-3xl border-4 transition-all flex flex-col items-center gap-2 ${config.contentType === 'word' ? 'border-orange-500 bg-orange-50 text-orange-700' : 'border-slate-50 bg-slate-50 text-slate-300'}`}><Icon name="FileText" size={24} /><span className="font-black text-xs md:text-lg font-sans">ë‹¨ì–´</span></button>
                                            <button onClick={() => { setConfig({...config, contentType: 'fraction'}); setActiveStep(3); showToast("ë¶„ìˆ˜ ëª¨ë“œ ì„ íƒ! ğŸ”¢"); }} className={`p-4 rounded-3xl border-4 transition-all flex flex-col items-center gap-2 ${config.contentType === 'fraction' ? 'border-amber-500 bg-amber-50 text-amber-700' : 'border-slate-50 bg-slate-50 text-slate-300'}`}><div className="flex flex-col items-center leading-none font-black font-black"><span>1</span><div className="h-0.5 w-4 bg-current" /><span>2</span></div><span className="font-black text-xs md:text-lg font-sans">ë¶„ìˆ˜</span></button>
                                            <button onClick={() => { setConfig({...config, contentType: 'picture'}); setActiveStep(2.5); }} className={`p-4 rounded-3xl border-4 transition-all flex flex-col items-center gap-2 ${config.contentType === 'picture' ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-slate-50 bg-slate-50 text-slate-300'}`}><Icon name="ImageIcon" size={24} /><span className="font-black text-xs md:text-lg font-sans">ê·¸ë¦¼</span></button>
                                        </div>
                                        {config.contentType === 'picture' && (
                                            <div className="flex gap-4 mt-6 animate-in font-sans">
                                                <button onClick={() => { setConfig({...config, pictureMode: 'ai'}); setActiveStep(3); showToast("AIê°€ ë§ˆë²•ì²˜ëŸ¼ ê·¸ë¦¼ì„ ê·¸ë ¤ìš”! âœ¨"); }} className={`flex-1 py-4 rounded-2xl border-4 flex flex-col items-center gap-1 font-black text-xs ${config.pictureMode === 'ai' ? 'bg-emerald-100 border-emerald-500 text-emerald-700' : 'bg-white border-slate-100 text-slate-300'}`}><Icon name="Sparkles" size={16} /> AI í™”ê°€</button>
                                                <button onClick={() => { setConfig({...config, pictureMode: 'upload'}); setActiveStep(3); showToast("ë‚´ ì‚¬ì§„ìœ¼ë¡œ ì¹´ë“œë¥¼ ë§Œë“¤ì–´ìš”! ğŸ“¸"); }} className={`flex-1 py-4 rounded-2xl border-4 flex flex-col items-center gap-1 font-black text-xs ${config.pictureMode === 'upload' ? 'bg-emerald-100 border-emerald-500 text-emerald-700' : 'bg-white border-slate-100 text-slate-300'}`}><Icon name="Upload" size={16} /> ì§ì ‘ ì˜¬ë¦¬ê¸°</button>
                                            </div>
                                        )}
                                    </section>

                                    <section className={`transition-all duration-500 ${isStepLocked(3) ? 'opacity-20 pointer-events-none' : ''}`}>
                                        <div className="flex items-center gap-3 mb-6 text-slate-800 font-sans">
                                            <div className="w-10 h-10 md:w-12 md:h-12 bg-orange-500 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg transform rotate-6 font-sans font-black">3</div>
                                            <h2 className="text-lg md:text-2xl font-black font-sans font-black">ì¹´ë“œ ê°¯ìˆ˜ ì„¤ì •</h2>
                                        </div>
                                        <div className="bg-orange-50/50 p-6 rounded-[40px] border-4 border-dashed border-orange-100 text-slate-900 font-sans font-black">
                                            <div className="flex justify-between items-end mb-6 font-black text-orange-600">
                                               <span className="text-3xl md:text-5xl font-black">{config.cardCount}<span className="text-lg font-sans">ì¥</span></span>
                                               <span className="text-xs bg-orange-500 text-white px-3 py-1 rounded-full shadow-md animate-pulse">ì´ {config.cardCount / 2}ì„¸íŠ¸</span>
                                            </div>
                                            <input type="range" min="8" max="24" step="2" value={config.cardCount} onChange={(e) => { setConfig({...config, cardCount: parseInt(e.target.value)}); setActiveStep(4); showToast("ì¸ì›ìˆ˜ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”! ğŸ‘¥"); }} className="w-full h-4 bg-white rounded-full appearance-none accent-orange-500 cursor-pointer shadow-inner" />
                                        </div>
                                    </section>

                                    <section className={`transition-all duration-500 ${isStepLocked(4) ? 'opacity-20 pointer-events-none' : ''}`}>
                                        <div className="flex items-center gap-3 mb-6 text-slate-800 font-sans font-black">
                                            <div className="w-10 h-10 md:w-12 md:h-12 bg-orange-500 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg transform -rotate-6 font-sans">4</div>
                                            <h2 className="text-lg md:text-2xl font-black">ì°¸ì—¬ ì¸ì›</h2>
                                        </div>
                                        <div className="grid grid-cols-4 gap-2 md:gap-4 text-slate-900">
                                            {[1, 2, 3, 4].map(n => (
                                                <button key={n} onClick={() => { setConfig({...config, playerCount: n}); setActiveStep(5); showToast("ë§ˆì§€ë§‰! ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”. âœï¸"); }} className={`aspect-square rounded-[20px] md:rounded-[30px] border-4 transition-all flex flex-col items-center justify-center gap-1 ${config.playerCount === n ? 'border-orange-500 bg-orange-50 text-orange-700 shadow-md font-sans' : 'border-slate-50 bg-slate-50 text-slate-300 active:scale-95 font-sans'}`}><Icon name="User" size={24} /><span className="font-black text-xs md:text-lg font-sans">{n === 1 ? 'í˜¼ì' : `${n}ì¸`}</span></button>
                                            ))}
                                        </div>
                                    </section>

                                    <section className={`bg-slate-50 rounded-[40px] p-6 md:p-14 border-4 border-slate-100 transition-all ${isStepLocked(5) ? 'opacity-20 pointer-events-none' : ''}`}>
                                        <div className="flex items-center gap-3 mb-8 pb-4 border-b-4 border-white text-slate-800 font-sans">
                                            <div className="w-8 h-8 md:w-10 md:h-10 bg-orange-500 rounded-xl flex items-center justify-center text-white font-black font-sans">5</div>
                                            <h2 className="font-black text-lg md:text-xl font-sans font-black">ì¹´ë“œ ë‚´ìš© ì…ë ¥</h2>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 text-slate-900 font-sans">
                                            {/* ê·¸ë¦¼ ëª¨ë“œ: ì§ ë§ì¶”ê¸° ë¡œì§ ìˆ˜ì • */}
                                            {config.contentType === 'picture' && pictureInputs.slice(0, config.cardCount/2).map((val, idx) => (
                                                <div key={idx} className="flex flex-col gap-4 p-4 bg-white rounded-3xl border-4 border-slate-100 shadow-sm transition-all focus-within:border-orange-300 font-sans">
                                                    <span className="text-[10px] font-black text-orange-400 italic">SET {idx + 1}</span>
                                                    <div className="flex flex-col gap-3 font-sans">
                                                        <div className="flex flex-col gap-1">
                                                            <label className="text-[10px] font-black text-slate-300 ml-1 uppercase font-sans tracking-tighter">
                                                                {config.pictureMode === 'ai' ? 'AI ê·¸ë¦¼ ê²€ìƒ‰ì–´' : 'ê¸€ì ì¹´ë“œ'}
                                                            </label>
                                                            <input type="text" placeholder="ë‹¨ì–´ ì…ë ¥" value={val.a} onChange={(e) => { const n = [...pictureInputs]; n[idx].a = e.target.value; setPictureInputs(n); }} className="w-full bg-slate-50 p-3 rounded-xl outline-none font-black text-sm" />
                                                        </div>
                                                        {config.pictureMode === 'upload' && (
                                                            <div className="flex flex-col gap-1 font-sans">
                                                                <label className="text-[10px] font-black text-slate-300 ml-1 uppercase font-sans tracking-tighter">ì‚¬ì§„ ì¹´ë“œ (í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ)</label>
                                                                <div className="relative overflow-hidden bg-slate-100 rounded-2xl h-48 md:h-64 flex items-center justify-center border-4 border-dashed border-slate-200 hover:border-orange-400 transition-all group font-sans">
                                                                    {val.b ? <img src={val.b} className="w-full h-full object-contain p-4 group-hover:scale-105 transition-transform" /> : (
                                                                        <div className="flex flex-col items-center gap-2 text-slate-300"><Icon name="Upload" size={40} /><span className="text-[10px] font-black uppercase tracking-widest font-sans font-black">Select Image</span></div>
                                                                    )}
                                                                    <input type="file" accept="image/*" onChange={(e) => handleFileUpload(idx, e.target.files[0])} className="absolute inset-0 opacity-0 cursor-pointer font-sans" />
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            ))}

                                            {/* ë‹¨ì–´ ëª¨ë“œ: ì§ ë§ì¶”ê¸° ë¡œì§ ìˆ˜ì • */}
                                            {config.contentType === 'word' && wordInputs.slice(0, config.cardCount/2).map((val, idx) => (
                                                <div key={idx} className="p-4 bg-white rounded-2xl border-4 border-slate-100 flex flex-col gap-2 font-sans">
                                                    <span className="text-[10px] font-black text-slate-300 uppercase">SET {idx + 1}</span>
                                                    <div className="flex gap-2">
                                                        <input type="text" placeholder="ì²« ë²ˆì§¸" value={val.a} onChange={(e) => { const n = [...wordInputs]; n[idx].a = e.target.value; setWordInputs(n); }} className="w-full bg-slate-50 p-2 rounded-xl outline-none font-black text-sm" />
                                                        {config.gameType === 'associative' && (
                                                            <input type="text" placeholder="ì§(ì˜ë¯¸)" value={val.b} onChange={(e) => { const n = [...wordInputs]; n[idx].b = e.target.value; setWordInputs(n); }} className="w-full bg-slate-50 p-2 rounded-xl outline-none font-black text-sm" />
                                                        )}
                                                    </div>
                                                </div>
                                            ))}

                                            {/* ë¶„ìˆ˜ ëª¨ë“œ: UI ë° ê¸€ì ì˜ë¦¼ ìˆ˜ì • */}
                                            {config.contentType === 'fraction' && fractionInputs.slice(0, config.cardCount/2).map((val, idx) => (
                                                <div key={idx} className="p-5 bg-white rounded-[35px] border-4 border-slate-100 shadow-sm flex flex-col gap-4 font-black font-sans">
                                                    <span className="text-[10px] font-black text-slate-300 uppercase">SET {idx + 1}</span>
                                                    <div className="flex items-center gap-4 bg-orange-50/50 p-5 rounded-[30px] border-2 border-orange-100 shadow-inner font-sans">
                                                        <div className="flex flex-col items-center leading-none min-w-[70px] font-sans">
                                                            <span className="text-[11px] font-black text-orange-400 mb-1 font-sans">ìì—°ìˆ˜</span>
                                                            <input type="text" value={val.a.whole} onChange={(e) => { const n = [...fractionInputs]; n[idx].a.whole = e.target.value; setFractionInputs(n); }} className="w-14 h-14 text-center text-xl font-black bg-white rounded-xl outline-none shadow-sm focus:ring-4 focus:ring-orange-100 font-sans" />
                                                        </div>
                                                        <div className="flex flex-col gap-1 flex-1 font-sans">
                                                            <input type="text" placeholder="ë¶„ì" value={val.a.num} onChange={(e) => { const n = [...fractionInputs]; n[idx].a.num = e.target.value; setFractionInputs(n); }} className="w-full h-8 text-center text-xs font-black bg-white rounded-lg outline-none border-b-4 border-orange-100 font-sans" />
                                                            <div className="h-1 bg-orange-200" />
                                                            <input type="text" placeholder="ë¶„ëª¨" value={val.a.den} onChange={(e) => { const n = [...fractionInputs]; n[idx].a.den = e.target.value; setFractionInputs(n); }} className="w-full h-8 text-center text-xs font-black bg-white rounded-lg outline-none border-b-4 border-orange-100 font-sans" />
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </section>
                                    
                                    <button disabled={isStepLocked(5)} onClick={handleStartRequest} className={`w-full py-6 md:py-8 rounded-[40px] shadow-xl md:shadow-[0_12px_0_0_#C2410C] transition-all active:scale-[0.97] active:translate-y-1 text-xl md:text-3xl font-black ${isStepLocked(5) ? 'bg-slate-100 text-slate-300' : 'bg-gradient-to-r from-orange-500 to-rose-500 text-white font-sans'}`}><Icon name="Rocket" size={32} className="inline mr-4 animate-bounce font-sans" /> ì§€ê¸ˆ ì‹œì‘í•˜ê¸°!</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* í”Œë ˆì´, ë¡œë”©, ë¯¸ë¦¬ë³´ê¸°, ê²°ê³¼ í™”ë©´ì€ ìœ„ ë¡œì§ì„ ë™ì¼í•˜ê²Œ ë”°ë¦„ */}
                    {view === 'loading' && <div className="min-h-screen flex items-center justify-center bg-orange-500 text-white font-black text-3xl animate-pulse font-sans">ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...</div>}
                    {view === 'playing' && (
                        <div className="min-h-screen p-4 flex flex-col items-center font-sans">
                            <div className="w-full max-w-4xl flex justify-between items-center mb-10 font-sans">
                                <div className="bg-white p-6 rounded-3xl shadow-xl flex items-center gap-4 font-sans">
                                    <Icon name="Timer" size={32} className="text-orange-500 font-sans" />
                                    <span className="text-4xl font-black font-mono font-sans">{Math.floor(elapsedTime / 60)}:{(elapsedTime % 60).toString().padStart(2, '0')}</span>
                                </div>
                                <button onClick={() => setView('settings')} className="bg-slate-800 text-white px-6 py-3 rounded-full font-black font-sans">ê·¸ë§Œí•˜ê¸°</button>
                            </div>
                            <div className="grid grid-cols-3 md:grid-cols-4 gap-4 w-full max-w-4xl font-sans font-black font-black font-black">
                                {cards.map((c, i) => (
                                    <div key={i} onClick={() => handleCardClick(i)} className="aspect-[3/4] perspective cursor-pointer font-sans font-black font-black font-black font-black">
                                        <div className={`relative w-full h-full transition-all duration-500 preserve-3d font-sans font-black font-black ${flippedIndices.includes(i) || matchedIds.includes(c.id) ? 'rotate-y-180' : ''}`}>
                                            <div className="absolute inset-0 backface-hidden bg-orange-400 rounded-3xl border-4 border-white shadow-lg flex items-center justify-center text-white font-sans font-black font-black"><Icon name="HelpCircle" size={40} /></div>
                                            <div className={`absolute inset-0 backface-hidden rotate-y-180 bg-white rounded-3xl border-4 border-emerald-500 shadow-lg flex items-center justify-center p-2 font-sans font-black font-black ${matchedIds.includes(c.id) ? 'bg-emerald-50 border-emerald-400' : ''}`}>
                                                {c.type === 'image' ? <img src={c.content} className="max-w-full max-h-full object-contain" /> : <span className="font-black text-lg text-center font-sans font-black font-black font-black">{c.content}</span>}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

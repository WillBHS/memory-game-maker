<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î©îÎ™®Î¶¨ Í≤åÏûÑ Î©îÏù¥Ïª§ - ÏóêÎìÄÌÖåÌÅ¨ ÏÜîÎ£®ÏÖò</title>
    <!-- ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #FFFBEB; margin: 0; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .perspective { perspective: 1200px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoom-in { from { transform: scale(0.95); } to { transform: scale(1); } }
        .animate-in { animation: fade-in 0.3s ease-out, zoom-in 0.3s ease-out; }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #F97316;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 4px solid white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ÏïÑÏù¥ÏΩò Î†åÎçîÎßÅ Ìó¨Ìçº (Lucide)
        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current && window.lucide) {
                    iconRef.current.innerHTML = '';
                    const i = document.createElement('i');
                    const kebabName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
                    i.setAttribute('data-lucide', kebabName);
                    i.style.width = `${size}px`;
                    i.style.height = `${size}px`;
                    i.style.display = 'inline-block';
                    i.className = className;
                    iconRef.current.appendChild(i);
                    window.lucide.createIcons();
                }
            }, [name, size, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center leading-none" />;
        };

        const App = () => {
            const [view, setView] = useState('settings'); 
            const [activeStep, setActiveStep] = useState(1); 
            const [toast, setToast] = useState({ show: false, message: "" });
            
            const [config, setConfig] = useState({
                cardCount: 12,
                contentType: null, 
                gameType: null, 
                playerCount: null,
            });

            // ÏûÖÎ†• Îç∞Ïù¥ÌÑ∞ ÏÉÅÌÉú
            const [wordInputs, setWordInputs] = useState(Array.from({ length: 12 }, () => ({ a: '', b: '' })));
            const [fractionInputs, setFractionInputs] = useState(Array.from({ length: 12 }, () => ({ a: { whole: '', num: '', den: '' }, b: { whole: '', num: '', den: '' } })));
            const [pictureInputs, setPictureInputs] = useState(Array.from({ length: 12 }, () => ({ a: '', b: null })));

            const [cards, setCards] = useState([]);
            const [flippedIndices, setFlippedIndices] = useState([]);
            const [matchedIds, setMatchedIds] = useState([]);
            const [scores, setScores] = useState([]); 
            const [attempts, setAttempts] = useState([]); 
            const [currentPlayer, setCurrentPlayer] = useState(0);
            const [isProcessing, setIsProcessing] = useState(false);
            const [loadingProgress, setLoadingProgress] = useState(0);
            const [loadingStatus, setLoadingStatus] = useState("");
            const [elapsedTime, setElapsedTime] = useState(0);
            const [gameStarted, setGameStarted] = useState(false); 
            const [errorMessage, setErrorMessage] = useState(null);
            const [capturedImage, setCapturedImage] = useState(null);
            const [isCapturing, setIsCapturing] = useState(false);
            const [userName, setUserName] = useState("");

            const resultRef = useRef(null);
            const timerRef = useRef(null);

            const isStepLocked = (step) => activeStep < step;
            const showToast = (message) => setToast({ show: true, message });

            useEffect(() => {
                if (toast.show) {
                    const t = setTimeout(() => setToast({ show: false, message: "" }), 3000);
                    return () => clearTimeout(t);
                }
            }, [toast.show]);

            // Ïπ¥Îìú ÏàòÎüâ ÎèôÍ∏∞Ìôî
            useEffect(() => {
                const pairCount = Math.floor(config.cardCount / 2);
                const syncArray = (prev, type) => {
                    const newArr = [...prev];
                    if (newArr.length < pairCount) {
                        const diff = pairCount - newArr.length;
                        const add = Array.from({ length: diff }, () => {
                            if (type === 'fraction') return { a: { whole: '', num: '', den: '' }, b: { whole: '', num: '', den: '' } };
                            return { a: '', b: '' };
                        });
                        return [...newArr, ...add];
                    }
                    return newArr.slice(0, pairCount);
                };
                setWordInputs(p => syncArray(p, 'word'));
                setPictureInputs(p => syncArray(p, 'picture'));
                setFractionInputs(p => syncArray(p, 'fraction'));
            }, [config.cardCount]);

            // ÌÉÄÏù¥Î®∏ Î°úÏßÅ
            useEffect(() => {
                if (view === 'playing' && config.playerCount === 1 && gameStarted) {
                    timerRef.current = setInterval(() => setElapsedTime(prev => prev + 1), 1000);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [view, config.playerCount, gameStarted]);

            const handleFileUpload = (index, file) => {
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const n = [...pictureInputs];
                    n[index] = { ...n[index], b: e.target.result };
                    setPictureInputs(n);
                };
                reader.readAsDataURL(file);
            };

            const handleStartRequest = async () => {
                const pairCount = Math.floor(config.cardCount / 2);
                let errors = [];

                if (config.contentType === 'word') {
                    wordInputs.slice(0, pairCount).forEach((v, i) => {
                        if (!v.a.trim() || (config.gameType === 'associative' && !v.b.trim())) errors.push(i + 1);
                    });
                } else if (config.contentType === 'picture') {
                    pictureInputs.slice(0, pairCount).forEach((v, i) => {
                        if (!v.b) errors.push(i + 1); // ÏÇ¨ÏßÑ ÌïÑÏàò
                        if (config.gameType === 'associative' && !v.a.trim()) errors.push(i + 1); // Ïßù ÎßûÏ∂îÍ∏∞ Ïãú Í∏ÄÏûê ÌïÑÏàò
                    });
                } else if (config.contentType === 'fraction') {
                    fractionInputs.slice(0, pairCount).forEach((v, i) => {
                        if (!v.a.num || !v.a.den) errors.push(i + 1);
                        if (config.gameType === 'associative' && (!v.b.num || !v.b.den)) errors.push(i + 1);
                    });
                }

                if (errors.length > 0) {
                    setErrorMessage(`${errors.join(', ')}Î≤à Ïπ¥Îìú ÎÇ¥Ïö©ÏùÑ Î™®Îëê Ï±ÑÏõåÏ£ºÏÑ∏Ïöî!`);
                    return;
                }

                setLoadingStatus("ÎÜÄÏù¥ Ï§ÄÎπÑ Ï§ë...");
                setView('loading');
                setLoadingProgress(50);
                
                setTimeout(() => prepareGameData(), 500);
            };

            const prepareGameData = () => {
                const pairCount = Math.floor(config.cardCount / 2);
                let deck = [];

                if (config.contentType === 'picture') {
                    for (let i = 0; i < pairCount; i++) {
                        if (config.gameType === 'associative') {
                            deck.push({ id: i, content: pictureInputs[i].a, type: 'text', instanceId: Math.random() });
                            deck.push({ id: i, content: pictureInputs[i].b, type: 'image', instanceId: Math.random() });
                        } else {
                            deck.push({ id: i, content: pictureInputs[i].b, type: 'image', instanceId: Math.random() });
                            deck.push({ id: i, content: pictureInputs[i].b, type: 'image', instanceId: Math.random() });
                        }
                    }
                } else if (config.contentType === 'word') {
                    wordInputs.slice(0, pairCount).forEach((v, i) => {
                        deck.push({ id: i, content: v.a, type: 'text', instanceId: Math.random() });
                        deck.push({ id: i, content: config.gameType === 'identical' ? v.a : v.b, type: 'text', instanceId: Math.random() });
                    });
                } else if (config.contentType === 'fraction') {
                    fractionInputs.slice(0, pairCount).forEach((v, i) => {
                        deck.push({ id: i, content: v.a, type: 'fraction', instanceId: Math.random() });
                        deck.push({ id: i, content: config.gameType === 'identical' ? v.a : v.b, type: 'fraction', instanceId: Math.random() });
                    });
                }

                setCards(deck.sort(() => Math.random() - 0.5));
                setLoadingProgress(100);
                setTimeout(() => startMainGame(), 500);
            };

            const startMainGame = () => {
                setScores(Array(config.playerCount || 1).fill(0));
                setAttempts(Array(config.playerCount || 1).fill(0));
                setCurrentPlayer(0);
                setMatchedIds([]);
                setFlippedIndices([]);
                setElapsedTime(0);
                setGameStarted(false);
                setView('playing');
            };

            const handleCardClick = (idx) => {
                if (isProcessing || flippedIndices.includes(idx) || matchedIds.includes(cards[idx].id)) return;
                if (!gameStarted && config.playerCount === 1) setGameStarted(true);

                const newFlipped = [...flippedIndices, idx];
                setFlippedIndices(newFlipped);
                if (newFlipped.length === 2) {
                    setIsProcessing(true);
                    setAttempts(prev => { const n = [...prev]; n[currentPlayer]++; return n; });
                    const [i1, i2] = newFlipped;
                    if (cards[i1].id === cards[i2].id) {
                        setTimeout(() => {
                            const newMatched = [...matchedIds, cards[i1].id];
                            setMatchedIds(newMatched);
                            setScores(prev => { const n = [...prev]; n[currentPlayer]++; return n; });
                            setFlippedIndices([]);
                            setIsProcessing(false);
                            if (newMatched.length === cards.length / 2) { setGameStarted(false); setTimeout(() => setView('result'), 600); }
                        }, 600);
                    } else {
                        setTimeout(() => {
                            setFlippedIndices([]);
                            if (config.playerCount > 1) setCurrentPlayer(p => (p + 1) % config.playerCount);
                            setIsProcessing(false);
                        }, 1000);
                    }
                }
            };

            const handleCapture = async () => {
                setIsCapturing(true);
                setTimeout(async () => {
                    const canvas = await html2canvas(resultRef.current, { backgroundColor: '#ffffff', scale: 2, useCORS: true });
                    setCapturedImage(canvas.toDataURL('image/png'));
                    setIsCapturing(false);
                }, 100);
            };

            return (
                <div className="min-h-screen selection:bg-orange-200 antialiased overflow-x-hidden font-sans">
                    {view === 'settings' && (
                        <div className="flex flex-col items-center py-6 md:py-10 px-4 animate-in">
                            {toast.show && (
                                <div className="fixed top-6 left-1/2 -translate-x-1/2 z-[100] bg-orange-600 text-white px-8 py-4 rounded-full shadow-xl flex items-center gap-3 animate-bounce max-w-[90vw]">
                                    <Icon name="Star" size={20} className="fill-white" />
                                    <span className="font-black text-sm md:text-lg tracking-tight">{toast.message}</span>
                                </div>
                            )}

                            {errorMessage && (
                                <div className="fixed top-6 z-50 bg-rose-500 text-white px-6 md:px-8 py-3 md:py-5 rounded-[40px] shadow-[0_8px_0_0_#9F1239] flex items-center gap-4 animate-bounce">
                                    <Icon name="ShieldAlert" size={24} className="text-white" />
                                    <p className="font-black text-xs md:text-sm">{errorMessage}</p>
                                    <button onClick={() => setErrorMessage(null)} className="p-1 hover:bg-white/20 rounded-full"><Icon name="X" size={16} /></button>
                                </div>
                            )}

                            <div className="w-full max-w-4xl bg-white rounded-[45px] md:rounded-[60px] shadow-[0_15px_0_0_#FEF3C7] border-[6px] md:border-[10px] border-white overflow-hidden relative">
                                <div className="bg-gradient-to-br from-orange-400 via-orange-500 to-rose-400 p-8 md:p-14 text-center text-white font-sans">
                                    <h1 className="text-2xl md:text-5xl font-black mb-2 italic flex justify-center items-center gap-4">
                                        <Icon name="Rocket" size={36} className="text-white" /> Î©îÎ™®Î¶¨ Í≤åÏûÑ Î©îÏù¥Ïª§
                                    </h1>
                                    <p className="bg-white/20 px-6 py-2 rounded-full inline-block text-[10px] md:text-sm font-black italic">ÎÇòÎßåÏùò Ïπ¥ÎìúÎ°ú ÏÑ§Í≥ÑÌïòÎäî Ï¶êÍ±∞Ïö¥ ÌïôÏäµ ÎÜÄÏù¥</p>
                                </div>

                                <div className="p-6 md:p-14 space-y-10 md:space-y-16">
                                    {/* 1Îã®Í≥Ñ */}
                                    <section className={`transition-all duration-500 ${activeStep === 1 ? 'scale-[1.02]' : ''}`}>
                                        <div className="flex items-center gap-3 mb-6 text-slate-800">
                                            <div className="w-10 h-10 md:w-12 md:h-12 bg-orange-500 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg transform rotate-3">1</div>
                                            <h2 className="text-lg md:text-2xl font-black">Í≤åÏûÑ Î™®ÎìúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</h2>
                                            {activeStep > 1 && <Icon name="CheckCircle2" size={24} className="ml-auto text-emerald-500" />}
                                        </div>
                                        <div className="grid grid-cols-2 gap-4 md:gap-8 text-slate-900">
                                            <div className="flex flex-col gap-2 text-center">
                                                <button onClick={() => { setConfig({...config, gameType: 'identical'}); setActiveStep(2); showToast("ÎòëÍ∞ôÏùÄ Î™®Ïñë Ï∞æÍ∏∞ Î™®Îìú ÏÑ†ÌÉù! üé®"); }} className={`p-4 md:p-8 rounded-[30px] border-4 transition-all flex flex-col items-center gap-3 ${config.gameType === 'identical' ? 'border-orange-500 bg-orange-50 text-orange-700 shadow-md' : 'border-slate-50 bg-slate-50 text-slate-300 active:scale-95'}`}>
                                                    <Icon name="Copy" size={40} className={config.gameType === 'identical' ? 'text-orange-500' : 'text-slate-300'} />
                                                    <span className="text-sm md:text-xl font-black">ÎòëÍ∞ôÏùÄ Ïπ¥Îìú</span>
                                                </button>
                                                <p className="text-[10px] text-slate-400 font-bold">Í∞ôÏùÄ Î™®Ïñë Ïπ¥Îìú 2Ïû•ÏùÑ Ï∞æÏïÑÏöî!</p>
                                            </div>
                                            <div className="flex flex-col gap-2 text-center">
                                                <button onClick={() => { setConfig({...config, gameType: 'associative'}); setActiveStep(2); showToast("ÏùòÎØ∏Í∞Ä Í∞ôÏùÄ Ïßù Ï∞æÍ∏∞ ÏÑ†ÌÉù! üé®"); }} className={`p-4 md:p-8 rounded-[30px] border-4 transition-all flex flex-col items-center gap-3 ${config.gameType === 'associative' ? 'border-rose-500 bg-rose-50 text-rose-700 shadow-md' : 'border-slate-50 bg-slate-50 text-slate-300 active:scale-95'}`}>
                                                    <Icon name="ArrowRightLeft" size={40} className={config.gameType === 'associative' ? 'text-rose-500' : 'text-slate-300'} />
                                                    <span className="text-sm md:text-xl font-black">ÏùòÎØ∏Í∞Ä Í∞ôÏùÄ Ïπ¥Îìú</span>
                                                </button>
                                                <p className="text-[10px] text-slate-400 font-bold">Îã®Ïñ¥ÏôÄ ÎúªÏ≤òÎüº ÏÑúÎ°ú ÏßùÏùÑ ÎßûÏ∂∞Ïöî!</p>
                                            </div>
                                        </div>
                                    </section>

                                    {/* 2Îã®Í≥Ñ */}
                                    <section className={`transition-all duration-500 ${isStepLocked(2) ? 'opacity-20 pointer-events-none grayscale' : ''}`}>
                                        <div className="flex items-center gap-4 mb-8 text-slate-800">
                                            <div className="w-10 h-10 md:w-12 md:h-12 bg-orange-500 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg transform -rotate-3">2</div>
                                            <h2 className="text-lg md:text-2xl font-black">Ïπ¥Îìú Í≤åÏûÑ Ï£ºÏ†ú</h2>
                                        </div>
                                        <div className="grid grid-cols-3 gap-3 md:gap-6 text-slate-900">
                                            <button onClick={() => { setConfig({...config, contentType: 'word'}); setActiveStep(3); showToast("Îã®Ïñ¥ Î™®Îìú ÏÑ†ÌÉù! üî¢"); }} className={`p-4 md:p-6 rounded-[25px] md:rounded-[40px] border-4 transition-all flex flex-col items-center gap-2 ${config.contentType === 'word' ? 'border-orange-500 bg-orange-50 text-orange-700' : 'border-slate-50 bg-slate-50 text-slate-300 hover:bg-white active:scale-95 font-black'}`}><Icon name="FileText" size={32} /><span className="font-black text-xs md:text-lg">Îã®Ïñ¥</span></button>
                                            <button onClick={() => { setConfig({...config, contentType: 'fraction'}); setActiveStep(3); showToast("Î∂ÑÏàò Î™®Îìú ÏÑ†ÌÉù! üî¢"); }} className={`p-4 md:p-6 rounded-[25px] md:rounded-[40px] border-4 transition-all flex flex-col items-center gap-2 ${config.contentType === 'fraction' ? 'border-amber-500 bg-amber-50 text-amber-700 font-sans' : 'border-slate-50 bg-slate-50 text-slate-300 font-sans hover:bg-white active:scale-95 font-black'}`}><div className="flex flex-col items-center leading-none font-black font-black"><span>1</span><div className="h-0.5 w-4 bg-current my-0.5" /><span>2</span></div><span className="font-black text-xs md:text-lg">Î∂ÑÏàò</span></button>
                                            <button onClick={() => { setConfig({...config, contentType: 'picture'}); setActiveStep(3); showToast("Í∑∏Î¶º ÏóÖÎ°úÎìú Î™®Îìú ÏÑ†ÌÉù! üì∏"); }} className={`p-4 md:p-6 rounded-[25px] md:rounded-[40px] border-4 transition-all flex flex-col items-center gap-2 ${config.contentType === 'picture' ? 'border-emerald-600 bg-emerald-50 text-emerald-700 shadow-md' : 'border-slate-50 bg-slate-50 text-slate-300 hover:bg-white active:scale-95 font-black'}`}><Icon name="ImageIcon" size={32} /><span className="font-black text-xs md:text-lg">Í∑∏Î¶º</span></button>
                                        </div>
                                    </section>

                                    {/* 3Îã®Í≥Ñ */}
                                    <section className={`transition-all duration-500 ${isStepLocked(3) ? 'opacity-20 pointer-events-none' : ''}`}>
                                        <div className="flex items-center gap-4 mb-8 text-slate-800">
                                            <div className="w-10 h-10 md:w-12 md:h-12 bg-orange-500 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg transform rotate-6">3</div>
                                            <h2 className="text-lg md:text-2xl font-black">Ïπ¥Îìú Í∞ØÏàò ÏÑ§Ï†ï</h2>
                                        </div>
                                        <div className="bg-orange-50/50 p-6 rounded-[40px] border-4 border-dashed border-orange-100 text-slate-900">
                                            <div className="flex justify-between items-end mb-6 font-black text-orange-600">
                                               <span className="text-3xl md:text-5xl font-black">{config.cardCount}<span className="text-lg">Ïû•</span></span>
                                               <span className="text-xs bg-orange-500 text-white px-3 py-1 rounded-full shadow-md animate-pulse">Ï¥ù {config.cardCount / 2}ÏÑ∏Ìä∏</span>
                                            </div>
                                            <input type="range" min="8" max="24" step="2" value={config.cardCount} onChange={(e) => { setConfig({...config, cardCount: parseInt(e.target.value)}); setActiveStep(4); showToast("Ïù∏ÏõêÏàòÎ•º Í≥®ÎùºÏ£ºÏÑ∏Ïöî! üë•"); }} className="w-full h-4 bg-white rounded-full appearance-none accent-orange-500 cursor-pointer shadow-inner" />
                                        </div>
                                    </section>

                                    {/* 4Îã®Í≥Ñ */}
                                    <section className={`transition-all duration-500 ${isStepLocked(4) ? 'opacity-20 pointer-events-none' : ''}`}>
                                        <div className="flex items-center gap-3 mb-6 text-slate-800 font-black">
                                            <div className="w-10 h-10 md:w-12 md:h-12 bg-orange-500 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg transform -rotate-6 font-sans">4</div>
                                            <h2 className="text-lg md:text-2xl font-black font-black">Ï∞∏Ïó¨ Ïù∏Ïõê</h2>
                                        </div>
                                        <div className="grid grid-cols-4 gap-2 md:gap-4 text-slate-900 font-black">
                                            {[1, 2, 3, 4].map(n => (
                                                <button key={n} onClick={() => { setConfig({...config, playerCount: n}); setActiveStep(5); showToast("ÎßàÏßÄÎßâ! ÎÇ¥Ïö©ÏùÑ Ï†ÅÏñ¥Ï£ºÏÑ∏Ïöî. ‚úèÔ∏è"); }} className={`aspect-square rounded-[20px] md:rounded-[30px] border-4 transition-all flex flex-col items-center justify-center gap-1 ${config.playerCount === n ? 'border-orange-500 bg-orange-50 text-orange-700 shadow-md font-black' : 'border-slate-50 bg-slate-50 text-slate-300 active:scale-95 font-black font-sans'}`}><Icon name="User" size={24} /><span className="font-black text-xs md:text-lg">{n === 1 ? 'ÌòºÏûê' : `${n}Ïù∏`}</span></button>
                                            ))}
                                        </div>
                                    </section>

                                    {/* 5Îã®Í≥Ñ */}
                                    <section className={`bg-slate-50 rounded-[40px] p-6 md:p-14 border-4 border-slate-100 transition-all ${isStepLocked(5) ? 'opacity-20 pointer-events-none' : ''}`}>
                                        <div className="flex items-center gap-3 mb-8 pb-4 border-b-4 border-white text-slate-800">
                                            <div className="w-8 h-8 md:w-10 md:h-10 bg-orange-500 rounded-xl flex items-center justify-center text-white font-black">5</div>
                                            <h2 className="font-black text-lg md:text-2xl">Ïπ¥Îìú ÎÇ¥Ïö© ÏûÖÎ†•</h2>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 text-slate-900">
                                            {/* Í∑∏Î¶º Î™®Îìú */}
                                            {config.contentType === 'picture' && pictureInputs.slice(0, config.cardCount/2).map((val, idx) => (
                                                <div key={idx} className="flex flex-col gap-4 p-5 bg-white rounded-3xl border-4 border-slate-100 shadow-sm transition-all focus-within:border-orange-300">
                                                    <span className="text-[10px] font-black text-orange-400 italic">SET {idx + 1}</span>
                                                    <div className="flex flex-col gap-3">
                                                        {config.gameType === 'associative' && (
                                                            <div className="flex flex-col gap-1">
                                                                <label className="text-[10px] font-black text-slate-300 ml-1 uppercase">ÏßùÏù¥ Îê† Îã®Ïñ¥</label>
                                                                <input type="text" placeholder="ÎÇ¥Ïö© ÏûÖÎ†•" value={val.a} onChange={(e) => { const n = [...pictureInputs]; n[idx].a = e.target.value; setPictureInputs(n); }} className="w-full bg-slate-50 p-3 rounded-xl outline-none font-black text-sm shadow-inner" />
                                                            </div>
                                                        )}
                                                        <div className="flex flex-col gap-1">
                                                            <label className="text-[10px] font-black text-slate-300 ml-1 uppercase">ÏÇ¨ÏßÑ Ïπ¥Îìú (ÏóÖÎ°úÎìú)</label>
                                                            <div className="relative overflow-hidden bg-slate-100 rounded-2xl h-64 flex items-center justify-center border-4 border-dashed border-slate-200 hover:border-orange-400 transition-all group">
                                                                {val.b ? <img src={val.b} className="w-full h-full object-contain p-4 group-hover:scale-105 transition-transform" alt="Up" /> : (
                                                                    <div className="flex flex-col items-center gap-2 text-slate-300"><Icon name="Upload" size={40} /><span className="text-[10px] font-black uppercase tracking-widest font-black">Select Image</span></div>
                                                                )}
                                                                <input type="file" accept="image/*" onChange={(e) => handleFileUpload(idx, e.target.files[0])} className="absolute inset-0 opacity-0 cursor-pointer" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}

                                            {/* Îã®Ïñ¥ Î™®Îìú */}
                                            {config.contentType === 'word' && wordInputs.slice(0, config.cardCount/2).map((val, idx) => (
                                                <div key={idx} className="p-4 bg-white rounded-2xl border-4 border-slate-100 flex flex-col gap-2">
                                                    <span className="text-[10px] font-black text-slate-300 uppercase">SET {idx + 1}</span>
                                                    <div className="flex gap-2">
                                                        <input type="text" placeholder="Ï≤´ Î≤àÏß∏" value={val.a} onChange={(e) => { const n = [...wordInputs]; n[idx].a = e.target.value; setWordInputs(n); }} className="w-full bg-slate-50 p-2 rounded-xl outline-none font-black text-sm shadow-inner" />
                                                        {config.gameType === 'associative' && (
                                                            <input type="text" placeholder="Ïßù(ÏùòÎØ∏)" value={val.b} onChange={(e) => { const n = [...wordInputs]; n[idx].b = e.target.value; setWordInputs(n); }} className="w-full bg-slate-50 p-2 rounded-xl outline-none font-black text-sm shadow-inner" />
                                                        )}
                                                    </div>
                                                </div>
                                            ))}

                                            {/* Î∂ÑÏàò Î™®Îìú */}
                                            {config.contentType === 'fraction' && fractionInputs.slice(0, config.cardCount/2).map((val, idx) => (
                                                <div key={idx} className="p-6 bg-white rounded-[35px] border-4 border-slate-100 shadow-sm flex flex-col gap-4 font-black">
                                                    <span className="text-[10px] font-black text-slate-300 uppercase">SET {idx + 1}</span>
                                                    <div className="flex items-center gap-4 bg-orange-50/50 p-5 rounded-[30px] border-2 border-orange-100 shadow-inner">
                                                        <div className="flex flex-col items-center leading-none min-w-[80px]">
                                                            <span className="text-[11px] font-black text-orange-400 mb-1">ÏûêÏó∞Ïàò</span>
                                                            <input type="text" value={val.a.whole} onChange={(e) => { const n = [...fractionInputs]; n[idx].a.whole = e.target.value; setFractionInputs(n); }} className="w-14 h-14 text-center text-xl font-black bg-white rounded-xl outline-none shadow-sm focus:ring-4 focus:ring-orange-100 font-black" />
                                                        </div>
                                                        <div className="flex flex-col gap-1 flex-1">
                                                            <input type="text" placeholder="Î∂ÑÏûê" value={val.a.num} onChange={(e) => { const n = [...fractionInputs]; n[idx].a.num = e.target.value; setFractionInputs(n); }} className="w-full h-8 text-center text-xs font-black bg-white rounded-lg outline-none border-b-4 border-orange-100" />
                                                            <div className="h-1 bg-orange-200" />
                                                            <input type="text" placeholder="Î∂ÑÎ™®" value={val.a.den} onChange={(e) => { const n = [...fractionInputs]; n[idx].a.den = e.target.value; setFractionInputs(n); }} className="w-full h-8 text-center text-xs font-black bg-white rounded-lg outline-none border-b-4 border-orange-100" />
                                                        </div>
                                                    </div>
                                                    {config.gameType === 'associative' && (
                                                       <div className="flex items-center gap-4 bg-rose-50/50 p-5 rounded-[30px] border-2 border-rose-100 shadow-inner">
                                                           <div className="flex flex-col items-center leading-none min-w-[80px]">
                                                               <span className="text-[11px] font-black text-rose-400 mb-1">ÏûêÏó∞Ïàò</span>
                                                               <input type="text" value={val.b.whole} onChange={(e) => { const n = [...fractionInputs]; n[idx].b.whole = e.target.value; setFractionInputs(n); }} className="w-14 h-14 text-center text-xl font-black bg-white rounded-xl outline-none shadow-sm focus:ring-4 focus:ring-rose-100 font-black font-sans" />
                                                           </div>
                                                           <div className="flex flex-col gap-1 flex-1">
                                                               <input type="text" placeholder="Î∂ÑÏûê" value={val.b.num} onChange={(e) => { const n = [...fractionInputs]; n[idx].b.num = e.target.value; setFractionInputs(n); }} className="w-full h-8 text-center text-xs font-black bg-white rounded-lg outline-none border-b-4 border-rose-100" />
                                                               <div className="h-1 bg-rose-200" />
                                                               <input type="text" placeholder="Î∂ÑÎ™®" value={val.b.den} onChange={(e) => { const n = [...fractionInputs]; n[idx].b.den = e.target.value; setFractionInputs(n); }} className="w-full h-8 text-center text-xs font-black bg-white rounded-lg outline-none border-b-4 border-rose-100" />
                                                           </div>
                                                       </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    </section>
                                    
                                    <button disabled={isStepLocked(5)} onClick={handleStartRequest} className={`w-full py-8 md:py-10 rounded-[45px] shadow-xl md:shadow-[0_15px_0_0_#C2410C] transition-all active:scale-[0.97] active:translate-y-2 active:shadow-none text-xl md:text-4xl font-black text-white ${isStepLocked(5) ? 'bg-slate-100 text-slate-300' : 'bg-gradient-to-r from-orange-500 to-rose-500 hover:brightness-110 font-sans'}`}><Icon name="Rocket" size={32} className="inline mr-4 animate-bounce" /> ÏßÄÍ∏à ÏãúÏûëÌïòÍ∏∞!</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Î°úÎî© ÌôîÎ©¥ */}
                    {view === 'loading' && (
                        <div className="min-h-screen bg-gradient-to-br from-orange-400 via-orange-500 to-rose-400 flex flex-col items-center justify-center p-6 text-white text-center font-sans animate-in">
                            <div className="bg-white/20 p-8 md:p-16 rounded-[60px] md:rounded-[80px] backdrop-blur-xl border-4 border-white/30 shadow-2xl max-w-sm md:max-w-md w-full">
                                <Icon name="Loader2" size={60} className="animate-spin mb-10 opacity-60 mx-auto text-white font-sans" />
                                <h2 className="text-xl md:text-3xl font-black mb-6 italic">{loadingStatus}</h2>
                                <div className="w-full h-4 md:h-8 bg-white/20 rounded-full overflow-hidden mb-8 ring-4 ring-white/10 shadow-inner font-sans">
                                    <div className="h-full bg-white transition-all duration-500 shadow-[0_0_20px_rgba(255,255,255,0.8)]" style={{ width: `${loadingProgress}%` }} />
                                </div>
                                <p className="text-white text-lg md:text-2xl font-black animate-pulse tracking-tight font-sans">Ïû†ÏãúÎßå Í∏∞Îã§Î†§ Ï£ºÏÑ∏Ïöî.</p>
                            </div>
                        </div>
                    )}

                    {/* ÌîåÎ†àÏù¥ ÌôîÎ©¥ */}
                    {view === 'playing' && (
                        <div className="min-h-screen bg-[#F1F5F9] flex flex-col p-4 md:p-10 font-sans overflow-x-hidden animate-in">
                            <div className="max-w-6xl mx-auto w-full flex flex-col md:flex-row gap-4 items-center justify-between mb-10 text-slate-900 font-sans font-black font-black font-black">
                                <div className="flex gap-4">
                                    {config.playerCount === 1 ? (
                                        <div className="bg-white px-8 md:px-12 py-5 md:py-8 rounded-[40px] md:rounded-[55px] shadow-xl flex items-center gap-6 border-2 border-slate-100 font-sans font-black font-black">
                                            <div className={`p-4 rounded-3xl ${gameStarted ? 'bg-orange-100 animate-pulse' : 'bg-slate-50'}`}><Icon name="Timer" size={32} className={gameStarted ? 'text-orange-500' : 'text-slate-300'} /></div>
                                            <div className="flex flex-col"><span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Time</span><span className="text-3xl md:text-6xl font-black text-slate-800 tabular-nums font-mono leading-none">{Math.floor(elapsedTime / 60)}:{(elapsedTime % 60).toString().padStart(2, '0')}</span></div>
                                        </div>
                                    ) : (
                                        scores.map((s, idx) => (
                                            <div key={idx} className={`px-6 md:px-12 py-5 md:py-8 rounded-[40px] md:rounded-[55px] flex flex-col items-center transition-all ${currentPlayer === idx ? 'bg-orange-500 text-white shadow-xl -translate-y-2 ring-8 ring-orange-100 border-4 border-orange-300 font-black' : 'bg-white text-slate-400 opacity-60 shadow-sm font-black'}`}>
                                                <div className="flex items-center gap-2 mb-1 font-black text-[10px] uppercase font-sans"><Icon name="User" size={16} /> P{idx + 1}</div>
                                                <span className="text-2xl md:text-5xl font-black leading-none">{s}Ï†ê</span>
                                            </div>
                                        ))
                                    )}
                                </div>
                                {config.playerCount > 1 && (
                                   <div className="bg-white px-8 md:px-12 py-3 md:py-5 rounded-full border-4 border-orange-100 flex items-center gap-4 shadow-xl animate-bounce">
                                      <Icon name="MousePointer2" size={24} className="text-orange-500" /><span className="font-black text-orange-900 text-base md:text-2xl tracking-tight font-sans">P{currentPlayer + 1}'s Turn!</span>
                                   </div>
                                )}
                            </div>
                            <div className={`max-w-6xl mx-auto w-full grid gap-4 md:gap-8 flex-1 ${config.cardCount > 16 ? 'grid-cols-4 md:grid-cols-6' : 'grid-cols-3 md:grid-cols-4'} font-black font-black`}>
                                {cards.map((card, idx) => {
                                    const isFlipped = flippedIndices.includes(idx) || matchedIds.includes(card.id);
                                    const isMatched = matchedIds.includes(card.id);
                                    return (
                                        <div key={card.instanceId} onClick={() => handleCardClick(idx)} className="relative aspect-[3/4] cursor-pointer group transition-transform hover:scale-[1.03] font-black">
                                            <div className={`relative w-full h-full transition-transform duration-700 preserve-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                                                <div className="absolute inset-0 backface-hidden flex items-center justify-center rounded-[25px] md:rounded-[45px] border-[6px] md:border-[10px] border-white shadow-2xl bg-gradient-to-br from-orange-400 to-rose-400 overflow-hidden text-white font-black font-sans font-black font-black">
                                                    <Icon name="HelpCircle" size={48} className="opacity-30 text-white font-black" />
                                                </div>
                                                <div className={`absolute inset-0 backface-hidden rotate-y-180 flex items-center justify-center rounded-[25px] md:rounded-[45px] border-[6px] md:border-[10px] bg-white shadow-2xl ${isMatched ? 'border-emerald-400 bg-emerald-50' : 'border-slate-50'} font-black`}>
                                                    <div className={!isFlipped ? 'invisible' : 'visible w-full h-full flex items-center justify-center p-3 animate-in zoom-in duration-300 font-black'}>
                                                        {card.type === 'image' ? (
                                                            <img src={card.content} className="max-w-full max-h-full object-contain rounded-2xl drop-shadow-sm font-sans" alt="Card" />
                                                        ) : card.type === 'text' ? (
                                                            <span className="text-sm md:text-3xl font-black text-center break-all text-slate-800 font-sans">{card.content}</span>
                                                        ) : (
                                                            <div className={`flex items-center gap-2 font-black ${isMatched ? 'text-emerald-600' : 'text-orange-600'} font-sans`}>
                                                                {card.content.whole && <span className="text-2xl md:text-5xl font-sans">{card.content.whole}</span>}
                                                                <div className="flex flex-col items-center leading-none font-sans font-black">
                                                                    <span className="text-xl md:text-4xl">{card.content.num}</span>
                                                                    <div className={`h-1 md:h-1.5 w-full rounded-full ${isMatched ? 'bg-emerald-500' : 'bg-orange-500'} my-0.5 font-sans`} />
                                                                    <span className="text-xl md:text-4xl">{card.content.den}</span>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {/* Í≤∞Í≥º ÌôîÎ©¥ */}
                    {view === 'result' && (
                        <div className="min-h-screen bg-[#FFFBEB] flex flex-col items-center justify-center p-4 md:p-10 font-sans text-slate-900 overflow-hidden relative animate-in font-black">
                            <div className="fixed -left-[2000px] top-0 font-black">
                                <div ref={resultRef} className="w-[800px] p-20 bg-white flex flex-col items-center border-[30px] border-orange-500 shadow-2xl relative font-sans font-black">
                                    <div className="w-full border-[6px] border-dashed border-orange-200 p-16 flex flex-col items-center text-center font-black">
                                        <div className="bg-orange-500 p-10 rounded-[55px] mb-10 shadow-2xl font-black"><Icon name="Trophy" size={100} className="text-white" /></div>
                                        <h1 className="text-7xl font-black mb-4 uppercase italic text-orange-600 tracking-tighter">Victory!</h1>
                                        <div className="h-2 w-48 bg-orange-200 rounded-full mb-12 font-sans" />
                                        {config.playerCount === 1 ? (
                                            <div className="text-center mb-12 font-black font-sans"><p className="text-8xl font-black mb-4">{userName || "ÎåÄÎã®Ìïú Ïñ¥Î¶∞Ïù¥"}</p><p className="text-slate-400 text-2xl font-bold font-sans">ÏúÑ Ïñ¥Î¶∞Ïù¥Îäî ÎÜÄÎùºÏö¥ Í∏∞ÏñµÎ†•ÏúºÎ°ú ÎÜÄÏù¥Î•º Ï†ïÎ≥µÌïòÏòÄÏäµÎãàÎã§.</p></div>
                                        ) : (
                                            <div className="w-full text-slate-800 font-sans font-black"><div className="text-center mb-12 font-black font-sans font-black"><p className="text-9xl font-black uppercase italic tracking-tighter">Good Game</p></div><div className="grid grid-cols-2 gap-10 w-full font-sans">{scores.map((s, i) => (<div key={i} className={`p-10 rounded-[50px] border-4 flex flex-col items-center ${scores[i] === Math.max(...scores) ? 'border-orange-500 bg-orange-50 shadow-2xl scale-105' : 'border-slate-100 bg-slate-50'}`}><p className={`text-2xl font-black mb-4 ${scores[i] === Math.max(...scores) ? 'text-orange-600' : 'text-slate-400'}`}>PLAYER {i+1}</p><span className="text-7xl font-black">{s}Ï†ê</span></div>))}</div></div>
                                        )}
                                        <div className="mt-24 flex justify-between w-full text-slate-300 font-black italic uppercase text-xl font-mono"><span>MEMORY GAME MAKER</span><span>{new Date().toLocaleDateString()}</span></div>
                                    </div>
                                </div>
                            </div>

                            <div className="relative z-10 flex flex-col items-center max-w-2xl w-full bg-white/95 backdrop-blur-3xl p-10 md:p-20 rounded-[60px] md:rounded-[80px] border-8 border-white shadow-[0_30px_0_0_#FEF3C7] text-slate-900 font-sans font-black font-black">
                                <div className="w-24 h-24 md:w-36 md:h-36 bg-gradient-to-br from-orange-400 to-rose-400 rounded-[50px] flex items-center justify-center shadow-2xl mb-8 animate-bounce font-black font-sans"><Icon name="Trophy" size={64} className="text-white" /></div>
                                <h2 className="text-4xl md:text-7xl font-black mb-6 uppercase tracking-tighter">Mission Clear!</h2>
                                <div className="w-full mb-10 md:mb-16 bg-slate-50/50 p-8 md:p-14 rounded-[50px] border-4 border-white shadow-inner font-sans font-black font-black">
                                    {config.playerCount === 1 ? (
                                        <div className="flex flex-col items-center gap-6 md:gap-12 font-sans font-black font-black font-black"><input type="text" placeholder="ÏπúÍµ¨Ïùò Ïù¥Î¶ÑÏùÑ Ï†ÅÏñ¥Ï£ºÏÑ∏Ïöî!" value={userName} onChange={(e) => setUserName(e.target.value)} className="w-full bg-white border-4 border-orange-100 rounded-[35px] py-5 md:py-8 text-center text-xl md:text-4xl font-black outline-none focus:border-orange-500 shadow-sm transition-all" /><span className="text-6xl md:text-9xl font-black text-orange-500 tabular-nums leading-none tracking-tighter font-mono">{Math.floor(elapsedTime / 60)}:{(elapsedTime % 60).toString().padStart(2, '0')}</span></div>
                                    ) : (
                                        <div className="grid grid-cols-2 gap-6 md:gap-10 tabular-nums font-mono font-sans font-black font-black font-black">{scores.map((s, i) => (<div key={i} className={`p-6 md:p-10 rounded-[45px] md:rounded-[60px] border-4 flex flex-col items-center transition-all ${scores[i] === Math.max(...scores) ? 'bg-orange-500 text-white shadow-xl scale-105' : 'bg-white border-slate-200 text-slate-300 opacity-60'}`}><span className="text-[10px] md:text-xs font-black uppercase mb-2 tracking-widest font-black">P{i+1} {scores[i] === Math.max(...scores) && 'üèÜ'}</span><span className="text-3xl md:text-6xl font-black leading-none font-black font-black">{s}Ï†ê</span><span className="text-[10px] font-black opacity-60 mt-2 font-black">ÏãúÎèÑ: {attempts[i]}Ìöå</span></div>))}</div>
                                    )}
                                </div>
                                <div className="flex flex-col gap-6 w-full max-w-md font-black font-sans font-black font-black font-black">
                                    <button onClick={handleCapture} disabled={isCapturing} className="w-full py-6 md:py-8 bg-emerald-500 hover:bg-emerald-600 text-white rounded-[40px] shadow-[0_10px_0_0_#059669] flex items-center justify-center gap-4 transition-all active:scale-95 text-xl md:text-3xl tracking-tight font-sans font-black">ÏÉÅÏû• Ïù¥ÎØ∏ÏßÄ ÎßåÎì§Í∏∞</button>
                                    <div className="flex gap-4 font-black"><button onClick={() => prepareGameData()} className="flex-1 py-5 md:py-7 bg-white text-orange-600 border-4 border-orange-100 rounded-[40px] shadow-[0_8px_0_0_#FED7AA] font-black text-lg md:text-2xl active:translate-y-1 active:shadow-none transition-all font-black">Îã§ÏãúÌïòÍ∏∞</button><button onClick={() => { setActiveStep(1); setView('settings'); setConfig({ cardCount: 12, contentType: null, pictureMode: null, gameType: null, playerCount: null }); }} className="flex-1 py-5 md:py-7 bg-orange-500 text-white rounded-[40px] shadow-[0_8px_0_0_#C2410C] font-black text-lg md:text-2xl active:translate-y-1 active:shadow-none transition-all font-black text-white">ÏÑ§Ï†ï</button></div>
                                </div>
                            </div>
                            
                            {capturedImage && (
                                <div className="fixed inset-0 z-[130] bg-orange-950/70 backdrop-blur-md flex flex-col items-center justify-center p-4 font-sans animate-in" onClick={() => setCapturedImage(null)}>
                                    <div className="relative max-w-lg w-full bg-white rounded-[50px] p-3 shadow-2xl border-8 md:border-[12px] border-white font-black" onClick={e => e.stopPropagation()}>
                                       <img src={capturedImage} className="w-full h-auto rounded-[35px] md:rounded-[45px]" alt="Captured Result" />
                                       <div className="absolute bottom-10 left-0 right-0 px-8 py-2 text-center font-black"><div className="inline-block bg-orange-500 text-white px-8 py-3 rounded-full font-black text-xs md:text-sm shadow-xl animate-bounce font-sans font-black">Ïù¥ÎØ∏ÏßÄÎ•º Íæπ ÎàåÎü¨ Ï†ÄÏû•ÌïòÏÑ∏Ïöî! üì∏</div></div>
                                       <button onClick={() => setCapturedImage(null)} className="absolute top-6 right-6 bg-black/50 text-white p-2 rounded-full hover:bg-black font-black uppercase font-black font-black font-black"><Icon name="X" size={20} className="text-white" /></button>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
